## 对称加密和非对称加密

> 2019/10/10

#### 对称加密

所谓对称加密，就是加密和解密使用的是同一个 “密钥”，通信过程中传输的是加密后的密文，必须使用密钥才能解密出明文。

TLS 中有很多对称加密算法可以选择，例如 RC4、DES、3DES、AES、ChaCha20 等，但是前三种算法都被认为是不安全的，通常禁止使用，目前常用的是 AES、ChaCha20。

AES 的意思是 "高级加密标准"，密钥长度可以是 128、192、256；它是 DES 算法的替代者，安全强度很高、性能也好，而且有硬件还会做特殊优化，所以非常流行，是应用最广泛的对称加密算法。

Cha20Cha20 是 Google 设计的另一种加密算法，密钥长度为固定的 256 位，纯软件运行速度要超过 AES，曾经在移动客户端上比较流行，但是在 ARMv8 之后加入了 AES 的硬件优化，所以现在不在具有明显的优势。

#### 加密分组模式

AES 等属于分组密码，只能加密固定长度的明文，如果想加密任意长度的明文，需要将明文按一定的位长分组，明文组经过加密运算得到密文组，密文组经过解密运算（加密运算的逆运算），还原成明文组。

将明文组计算得到密文组的方法，被称为加密分组模式。

目前最新的分组模式被称为 AEAD ( Authenticated Encryption with Associated Data )，在加密的同时增加了认证的功能，常用的是 GCM、CCM 和 Poly1305。

把这些组合起来，就能得到 TLS 密码套件中的对称加密算法，比如：AES128-GEM，意思是使用密钥长度为 128 位的 AES 算法，使用的分组模式是 GEM。

Cha20Cha20 属于流加密算法，不需要分组模式。

#### 非对称加密

对称加密看上去好像完美的实现了机密性，但是其中有一个很大的问题：如何把密钥安全的传递给对方，术语叫做 “密钥交换”。

为了解决这个问题，出现了非对称加密。

它有两个密钥，一个叫 “公钥”，一个叫 “私钥”，两个密钥是不同的，公钥可以公开给任何人使用，私钥必须保密。使用公钥加密后，只能用私钥解密，反之使用私钥加密，只能用公钥解密。

非对称加密能够解决密钥交换问题，由网站保管私钥，在网上任意分发公钥，我们想登录网站只要使用公钥加密就好了，密文只能私钥持有者才能解密。

在 TLS 中只有很少的几种非对称加密算法，例如：DH、DSA、RSA、ECC 等。

RSA 是非对称加密算法中最著名的一个，基于 “整数分解” 的数学难题，使用两个超大素数的乘积作为生成密钥的材料，想从公钥推算出私钥是非常困难的。

ECC 是非对称加密算法中的后起之秀，基于 “椭圆曲线离散对数” 的数学难题，使用特定的曲线方程和基点生成公钥和私钥。

比起 RSA，ECC 在安全强度和性能上有明显的优势，160 位的 ECC 相当于 1024 位的 RSA，而 224 位的 ECC 相当于 2048 位的 RSA，因为密钥短，所以相应的计算量、消耗的内存也就是少，性能也就上去了。

#### 混合加密

虽然非对称加密解决了 “密钥交换” 这个问题，但是它们都基于复杂的数学难题，运算速度很慢。如果仅用非对称加密，虽然保证了安全，但是通信速度慢的没办法用。

非对称加密还有一个缺点就是需要更多的位数，相同强度的对称密钥要比非对称密钥短；对称密钥一般都128位、256位，而 rsa 一般要2048位，不过椭圆曲线的会短一点。

目前 TLS 中使用的是混合加密方式：

1. 通讯刚开始的时候使用非对称加密，解决密钥交换问题
2. 使用公钥加密 “会话密钥”，发送给另一方
3. 对方拿到密文后，使用私钥解密，获得 “会话密钥”
4. 这样就完成了密钥交换，之后双方使用对称加密进行通信

总结来说，就是通信双方使用非对称加密协商出一个对于对称加密的密钥，之后使用对称加密进行通信，安全与性能兼顾。

#### 私钥加密的作用

私钥加密只能用公钥来解密，公钥是公开的，那么私钥加密有什么用呢？

签名、身份认证，证明该信息是谁发出的。