## HTTP 的重定向

> 2019/9/25

#### 重定向概述

状态码：

- 301 永久重定向，表明原来的 URI 已经永久性的不存在了，今后所有的请求都必须改用新的 URI。浏览器看见 301 就知道原来的 URI 过时了，就会做适当的优化，比如历史记录、更新书签，下次再访问的时候可能会直接使用新的 URI 省去了一步跳转；爬虫看到 301 也会更新索引，不再使用老的 URI。
- 302 临时重定向，意思是原来的 URI 处于临时维护状态，暂时使用新的 URI 顶替一下，浏览器或者爬虫看到 302，会认为原来的 URI 仍然有效，不会记录新的 URI，下次访问还会访问原来的 URI。

字段：

**Location** 属于响应字段，只能出现在响应报文里，必须配合 301/302 的转态码才有意义，它标记的服务器要求重定向的 URI。

浏览器或者其他网络请求的客户端收到 301/302 报文，会检查响应头里面是否有 Location 字段，如果有就从字段中取出 URI 重新放 HTTP 请求。

#### 重定向的应用场景

1. 资源不可用、系统维护等等，需要一个新的 URI 来代替
2. 让多个网址都跳转到一个 URI，增加访问入口的同时，还不会增加工作量

#### 重定向的问题

1. 性能损耗：毕竟重定向机制多了一次 HTTP 请求，大量的跳转对服务器的影响也是不可忽略的，站内重定向还好说，可以长连接复用，站外重定向要开两个连接，成本增加一倍。

2. 循环跳转：如果重定向的策略出现问题，可能会出现 A->B->C->A  的无限循环，使得正常的请求无法进行。

   所以 HTTP 协议特别规定，浏览器必须具备 “ 循环跳转 ” 的检测能力，发现这种情况应该停止发送请求并给予错误提示。 

