## TCP/IP 协议概述

> 2019/9/16

TCP/IP 协议实际上是一系列网络通信协议的统称，其中最核心的两个协议是 TCP 和 IP，其他的还有 HTTP、UDP、DNS、FTP 等等，共同构成了一个复杂但有层次的协议栈。

这个协议栈共分为 4 层，应用层、传输层、网际层、链路层。

#### TCP/IP 的四层模型

##### 链路层：

链路层用来处理连接网络的硬件部分，负责在以太网、WiFi 这样的底层网络上发送原始数据包，工作在网卡这个层次，使用 MAC 地址来标记网络上的设备，所以有有时候也叫 MAC 层。

##### 网际层：

网络层用来处理网络上流动的数据包，为其选择路由。IP 协议就位于这一层，因为 IP 协议定义了 ” IP 地址 “ 的概念，所以就可以在链路层的基础上，用 IP 地址取代 MAC 地址，将许许多多的计算机连接成一个巨大的虚拟网络。

##### 传输层：

传输层的作用是保证数据在 IP 地址标记的两点之间可靠的传输，传输层有两个不同性质的协议：TCP 协议和 UDP 协议。

##### 应用层：

应用层提供了各种面向具体应用的协议；例如：FTP 、DNS 、 HTTP 等。

#### OSI 的七层模型

1. 物理层：网卡的物理形式，例如：电缆、光纤、网卡、集线器等。
2. 数据链路层：相当于 TCP/IP 的链路层
3. 网络层：相当于 TCP/IP 的网际层
4. 传输层：相当于 TCP/IP 的传输层
5. 会话层：维护网络中的状态，保持会话和同步
6. 表示层：把数据转换为合适、可理解的语法和语义
7. 应用层：面向具体的应用传输数据

![](../resource/image/9d9b3c9274465c94e223676b6d434194.png)

#### 网络数据的传输

网络数据传输是有三要素：

- IP 地址
- 端口号
- 传输协议：TCP、UDP

使用 TCP/IP 协议族进行网络通信时，会通过分层的顺序与对方进行通信；发送端从应用层往下走，接收端从链路层往上走。

数据在网络之间传输，其实就是利用 TCP/IP 协议栈逐层封装与解封装的过程。发送端在层与层之间传输数据时，每经过一层必定会打上一个该层所属的首部消息；反之接收端在层与层传输数据时，每经过一层时会把对应的首部消息去掉。

![](../resource/image/70bc19acacf2245fa841349f15cb7a6f.png)

#### IP 协议

IP 协议的主要作用是解决寻址和路由问题，以及如何在两点间传递数据包。

在两点间传递数据包需要两个重要的要素：IP 地址和 MAC 地址，IP 地址指明了节点被分配的地址，用来定位互联网上的计算机，MAC 地址是网卡所属的固定地址。

IP 间的通信依赖于 MAC 地址，通信的双方在同一局域网内的情况是很少的，通常是经过多台计算机和网络设备的中转才能连接到对方，而在进行中转时，会使用 ARP 协议通过对方的 IP 地址查询出 MAC 地址。

#### TCP / UDP 协议

TCP 是可靠的协议，面向连接，通过三次握手建立传输数据的通道，在通道中传输连续的字节流。

因为需要建立连接，效率略低 ，主要应用于一些对传输可靠性要求高，对速度要求不是很高的场景，例如如：文件上传下载。

UDP 是不可靠协议，无连接，将数据源和目的封装成数据包，每个包的大小在 64k 以内，因为不用建立连接，速度快。

因为 UDP 是无连接的，所以不管连上连不上它都发送数据，所以数据也就有可能收不到，主要应用于一些对传输可靠性要求不高，而对传输速度要求高的场景，如：聊天、视频会议、桌面共享。

#### DNS 

在 TCP IP 协议中使用 IP 地址来标志计算机，数字形式对于计算机很方便，但是对于我们人类来说既难以记忆，又难以输入。

于是就出现了 DNS ，它提供了域名和 IP 地址之间的解析服务。

#### URI / URL

URI：统一资源标志符，用来唯一标记互联网上的资源。

URL：统一资源定位符，也就是我们俗称的网址，它是 URI 的一个子集。

URI 的构成：

```http
http://nginx.org/en/download.html
```

1. 协议名，即访问资源应该使用的协议：http
2. 主机名，即互联网上的主机标识，可以是域名或者 IP 地址，nginx.org
3. 路径，即资源在主机上的位置，使用 / 分割多级目录，/en/download.html

#### HTTPS

HTTPS 的全称是 HTTP over SSL/TLS，也就是运行在 SSL/TLS 协议上的 HTTP。

SSL/TLS 是一个负责加密通信的安全协议，运行在 TCP/IP 协议之上。

SSL 和 TLS 是一个东西，以前叫 SSL 后来在 3.0 时被标准化，改名为 TLS。

SSL/TLS 协议使用了非常密码学的东西，综合了对称加密、非对称加密、摘要算法、数字签名、数字证书等技术，能够在不安全的环境中为通信的双方创建一个私密的、安全的传输通道。